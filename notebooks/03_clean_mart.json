{"cells":[{"cell_type":"markdown","id":"8837b500","metadata":{"id":"8837b500"},"source":["# 03 ‚Äî CLEAN ‚Üí Mart | ISPRA Catasto Rifiuti\n","\n","## Cosa fa questo notebook\n","A partire dal dataset **clean** (output del notebook 02), il notebook produce **due output**:\n","\n","1) **MART ‚Äúsnapshot‚Äù 2020‚Äì2023** (1 riga = 1 comune)  \n","   - RD% 2020 e 2023, variazione in punti percentuali  \n","   - RU totali 2020 e 2023 (t), variazione  \n","   - RU pro capite 2020 e 2023 (kg/ab), variazione (supporto interpretativo)  \n","   - classificazione in quadranti + flag *RD‚Üë & RU‚Üë* (risposta diretta alla domanda civica)\n","\n","2) **Serie storica 2019‚Äì2023** (formato ‚Äúlong‚Äù, 1 riga = comune-anno)  \n","   - utile per una **seconda pagina Power BI** con trend e approfondimenti temporali\n","\n","## Output\n","- `data/mart/mart_comuni_delta_2020_2023_dashboard_IT.csv`\n","- `data/mart/serie_comuni_rd_ru_2019_2023_powerbi_IT.csv`\n","\n","Output Drive: https://drive.google.com/drive/folders/1Y1CCmyshifHTIQ1TT0jpNl-9C_HzLDgP?usp=drive_link\n","\n","## Autori\n","\n","- Matteo Cavo ‚Äì Progettazione modello MART, definizione indicatori, classificazione quadranti\n","- Gabriele Sala ‚Äì Revisione metodologica, validazione e integrazione nel progetto\n"]},{"cell_type":"code","execution_count":null,"id":"14cabb2f","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"14cabb2f","outputId":"281e5c58-bbdd-4346-cf14-921ae7131a29","executionInfo":{"status":"ok","timestamp":1771314170128,"user_tz":-60,"elapsed":15976,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n","Google Drive montato.\n","BASE_PATH  : /content/drive/MyDrive/DataCivicLab/data\n","CLEAN_FILE : /content/drive/MyDrive/DataCivicLab/data/clean/ispra_catasto_rifiuti/ispra_catasto_rifiuti_clean.parquet\n","OUTPUT_DIR : /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti\n","META_DIR   : /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/_meta\n"]}],"source":["import os\n","from pathlib import Path\n","import pandas as pd\n","import numpy as np\n","import unicodedata\n","\n","# --- GOOGLE COLAB SUPPORT ---\n","IN_COLAB = False\n","try:\n","    from google.colab import drive\n","    drive.mount('/content/drive')\n","    IN_COLAB = True\n","    print(\"Google Drive montato.\")\n","except Exception:\n","    print(\"Esecuzione in ambiente locale (Drive non montato).\")\n","\n","# ======================\n","# PATHS (DataCivicLab / Lab standard)\n","# ======================\n","# Regola Lab: tutto sotto .../DataCivicLab/data/\n","#\n","# Colab (Drive-first): /content/drive/MyDrive/DataCivicLab/data\n","# Locale: imposta DCL_DATA_PATH oppure modifica BASE_PATH_LOCAL\n","\n","BASE_PATH_DRIVE = Path(\"/content/drive/MyDrive/DataCivicLab/data\")\n","BASE_PATH_LOCAL = Path(\"..\").resolve() / \"data\"   # se notebook dentro /notebooks nella repo\n","\n","# Override opzionale (consigliato): export DCL_DATA_PATH=\".../DataCivicLab/data\"\n","BASE_PATH = Path(os.getenv(\"DCL_DATA_PATH\", str(BASE_PATH_DRIVE if IN_COLAB else BASE_PATH_LOCAL)))\n","\n","# --- Directory standard ---\n","RAW_DIR   = BASE_PATH / \"raw\"\n","CLEAN_DIR = BASE_PATH / \"clean\"\n","MART_DIR  = BASE_PATH / \"mart\"\n","\n","# --- Progetto specifico (qui: rifiuti) ---\n","MART_DOMAIN_DIR = MART_DIR / \"ispra_catasto_rifiuti\"\n","META_DIR = MART_DOMAIN_DIR / \"_meta\"\n","\n","# --- File clean input (standard Lab) ---\n","CLEAN_FILE_DEFAULT = CLEAN_DIR / \"ispra_catasto_rifiuti\" / \"ispra_catasto_rifiuti_clean.parquet\"\n","CLEAN_FILE = Path(os.getenv(\"CLEAN_FILE\", str(CLEAN_FILE_DEFAULT)))\n","\n","# --- Output dir (default: mart/rifiuti) ---\n","OUTPUT_DIR = Path(os.getenv(\"OUTPUT_DIR\", str(MART_DOMAIN_DIR)))\n","\n","# --- Creazione cartelle ---\n","OUTPUT_DIR.mkdir(parents=True, exist_ok=True)\n","META_DIR.mkdir(parents=True, exist_ok=True)\n","\n","print(\"BASE_PATH  :\", BASE_PATH)\n","print(\"CLEAN_FILE :\", CLEAN_FILE)\n","print(\"OUTPUT_DIR :\", OUTPUT_DIR)\n","print(\"META_DIR   :\", META_DIR)\n"]},{"cell_type":"code","execution_count":null,"id":"8bb3b6ff","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":325},"id":"8bb3b6ff","outputId":"4b9159a1-17b6-469e-f4af-a9715794f010","executionInfo":{"status":"ok","timestamp":1771314174129,"user_tz":-60,"elapsed":1163,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Shape: (38631, 26)\n","Colonne: ['codice_comune_istat', 'regione', 'provincia', 'comune', 'popolazione', 'dato_riferito_a', 'frazione_umida1_t', 'verde_t', 'carta_e_cartone_t', 'vetro_t', 'legno_t', 'metallo_t', 'plastica_t', 'raee_t', 'tessili_t', 'selettiva_t', 'rifiuti_da_c_e_d_t', 'pulizia_stradale_a_recupero_t', 'ingombranti_misti_a_recupero_t', 'altro_t', 'raccolta_differenziata_tonnellate', 'ingombranti_a_smaltimento_t', 'indifferenziato_t', 'rifiuti_urbani_tonnellate', 'raccolta_differenziata_perc', 'anno']\n"]},{"output_type":"execute_result","data":{"text/plain":["  codice_comune_istat   regione provincia           comune  popolazione  \\\n","0            01001001  Piemonte    Torino           AGLIE'       2621.0   \n","1            01001002  Piemonte    Torino          AIRASCA       3598.0   \n","2            01001003  Piemonte    Torino     ALA DI STURA        441.0   \n","3            01001004  Piemonte    Torino  ALBIANO D'IVREA       1644.0   \n","4            01001006  Piemonte    Torino           ALMESE       6426.0   \n","\n","  dato_riferito_a  frazione_umida1_t   verde_t  carta_e_cartone_t  vetro_t  \\\n","0          Comune            255.275   363.247             92.683   95.948   \n","1          Comune            174.489   140.355            239.377  100.730   \n","2          Comune              3.240    13.450             23.636   26.368   \n","3          Comune            175.768    23.606             67.644   59.639   \n","4          Comune            465.505  1237.986            352.661  268.956   \n","\n","   ...  rifiuti_da_c_e_d_t  pulizia_stradale_a_recupero_t  \\\n","0  ...               6.643                          2.860   \n","1  ...              10.801                          7.760   \n","2  ...               0.159                            NaN   \n","3  ...              15.276                          2.775   \n","4  ...              64.082                         63.484   \n","\n","   ingombranti_misti_a_recupero_t  altro_t  raccolta_differenziata_tonnellate  \\\n","0                          34.280    1.995                           1007.864   \n","1                         110.507      NaN                           1236.815   \n","2                          30.587    0.005                            112.624   \n","3                          12.448    3.355                            503.335   \n","4                          96.568    5.621                           2954.946   \n","\n","   ingombranti_a_smaltimento_t  indifferenziato_t  rifiuti_urbani_tonnellate  \\\n","0                          NaN            549.186                   1557.050   \n","1                          NaN            734.180                   1970.995   \n","2                          NaN            172.960                    285.584   \n","3                          NaN            192.089                    695.424   \n","4                          NaN            704.745                   3659.691   \n","\n","   raccolta_differenziata_perc  anno  \n","0                        64.73  2019  \n","1                        62.75  2019  \n","2                        39.44  2019  \n","3                        72.38  2019  \n","4                        80.74  2019  \n","\n","[5 rows x 26 columns]"],"text/html":["\n","  <div id=\"df-f7172361-5a73-4394-af2d-c225eaf6e369\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>codice_comune_istat</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>popolazione</th>\n","      <th>dato_riferito_a</th>\n","      <th>frazione_umida1_t</th>\n","      <th>verde_t</th>\n","      <th>carta_e_cartone_t</th>\n","      <th>vetro_t</th>\n","      <th>...</th>\n","      <th>rifiuti_da_c_e_d_t</th>\n","      <th>pulizia_stradale_a_recupero_t</th>\n","      <th>ingombranti_misti_a_recupero_t</th>\n","      <th>altro_t</th>\n","      <th>raccolta_differenziata_tonnellate</th>\n","      <th>ingombranti_a_smaltimento_t</th>\n","      <th>indifferenziato_t</th>\n","      <th>rifiuti_urbani_tonnellate</th>\n","      <th>raccolta_differenziata_perc</th>\n","      <th>anno</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>01001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>AGLIE'</td>\n","      <td>2621.0</td>\n","      <td>Comune</td>\n","      <td>255.275</td>\n","      <td>363.247</td>\n","      <td>92.683</td>\n","      <td>95.948</td>\n","      <td>...</td>\n","      <td>6.643</td>\n","      <td>2.860</td>\n","      <td>34.280</td>\n","      <td>1.995</td>\n","      <td>1007.864</td>\n","      <td>NaN</td>\n","      <td>549.186</td>\n","      <td>1557.050</td>\n","      <td>64.73</td>\n","      <td>2019</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>01001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>AIRASCA</td>\n","      <td>3598.0</td>\n","      <td>Comune</td>\n","      <td>174.489</td>\n","      <td>140.355</td>\n","      <td>239.377</td>\n","      <td>100.730</td>\n","      <td>...</td>\n","      <td>10.801</td>\n","      <td>7.760</td>\n","      <td>110.507</td>\n","      <td>NaN</td>\n","      <td>1236.815</td>\n","      <td>NaN</td>\n","      <td>734.180</td>\n","      <td>1970.995</td>\n","      <td>62.75</td>\n","      <td>2019</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>01001003</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>ALA DI STURA</td>\n","      <td>441.0</td>\n","      <td>Comune</td>\n","      <td>3.240</td>\n","      <td>13.450</td>\n","      <td>23.636</td>\n","      <td>26.368</td>\n","      <td>...</td>\n","      <td>0.159</td>\n","      <td>NaN</td>\n","      <td>30.587</td>\n","      <td>0.005</td>\n","      <td>112.624</td>\n","      <td>NaN</td>\n","      <td>172.960</td>\n","      <td>285.584</td>\n","      <td>39.44</td>\n","      <td>2019</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>01001004</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>ALBIANO D'IVREA</td>\n","      <td>1644.0</td>\n","      <td>Comune</td>\n","      <td>175.768</td>\n","      <td>23.606</td>\n","      <td>67.644</td>\n","      <td>59.639</td>\n","      <td>...</td>\n","      <td>15.276</td>\n","      <td>2.775</td>\n","      <td>12.448</td>\n","      <td>3.355</td>\n","      <td>503.335</td>\n","      <td>NaN</td>\n","      <td>192.089</td>\n","      <td>695.424</td>\n","      <td>72.38</td>\n","      <td>2019</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>01001006</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>ALMESE</td>\n","      <td>6426.0</td>\n","      <td>Comune</td>\n","      <td>465.505</td>\n","      <td>1237.986</td>\n","      <td>352.661</td>\n","      <td>268.956</td>\n","      <td>...</td>\n","      <td>64.082</td>\n","      <td>63.484</td>\n","      <td>96.568</td>\n","      <td>5.621</td>\n","      <td>2954.946</td>\n","      <td>NaN</td>\n","      <td>704.745</td>\n","      <td>3659.691</td>\n","      <td>80.74</td>\n","      <td>2019</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5 rows √ó 26 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f7172361-5a73-4394-af2d-c225eaf6e369')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-f7172361-5a73-4394-af2d-c225eaf6e369 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-f7172361-5a73-4394-af2d-c225eaf6e369');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"df"}},"metadata":{},"execution_count":2}],"source":["# ======================\n","# CARICA DATI PULITI\n","# ======================\n","df = pd.read_parquet(CLEAN_FILE)\n","\n","print(\"Shape:\", df.shape)\n","print(\"Colonne:\", df.columns.tolist())\n","df.head()"]},{"cell_type":"code","execution_count":null,"id":"aa88a932","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":290},"id":"aa88a932","outputId":"c13c4906-e09f-45fc-92a5-6a6f5e0bad03","executionInfo":{"status":"ok","timestamp":1771314177042,"user_tz":-60,"elapsed":279,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  codice_comune_istat   regione provincia           comune  popolazione  \\\n","0            01001001  Piemonte    Torino           Aglie‚Äô       2621.0   \n","1            01001002  Piemonte    Torino          Airasca       3598.0   \n","2            01001003  Piemonte    Torino     Ala Di Stura        441.0   \n","3            01001004  Piemonte    Torino  Albiano D‚ÄôIvrea       1644.0   \n","4            01001006  Piemonte    Torino           Almese       6426.0   \n","\n","  dato_riferito_a  frazione_umida1_t   verde_t  carta_e_cartone_t  vetro_t  \\\n","0          Comune            255.275   363.247             92.683   95.948   \n","1          Comune            174.489   140.355            239.377  100.730   \n","2          Comune              3.240    13.450             23.636   26.368   \n","3          Comune            175.768    23.606             67.644   59.639   \n","4          Comune            465.505  1237.986            352.661  268.956   \n","\n","   ...  pulizia_stradale_a_recupero_t  ingombranti_misti_a_recupero_t  \\\n","0  ...                          2.860                          34.280   \n","1  ...                          7.760                         110.507   \n","2  ...                            NaN                          30.587   \n","3  ...                          2.775                          12.448   \n","4  ...                         63.484                          96.568   \n","\n","   altro_t  raccolta_differenziata_tonnellate  ingombranti_a_smaltimento_t  \\\n","0    1.995                           1007.864                          NaN   \n","1      NaN                           1236.815                          NaN   \n","2    0.005                            112.624                          NaN   \n","3    3.355                            503.335                          NaN   \n","4    5.621                           2954.946                          NaN   \n","\n","   indifferenziato_t  totale_ru_t  percentuale_rd  anno  istat_comune_6  \n","0            549.186     1557.050           64.73  2019          001001  \n","1            734.180     1970.995           62.75  2019          001002  \n","2            172.960      285.584           39.44  2019          001003  \n","3            192.089      695.424           72.38  2019          001004  \n","4            704.745     3659.691           80.74  2019          001006  \n","\n","[5 rows x 27 columns]"],"text/html":["\n","  <div id=\"df-92f7c6e4-a888-4ca0-812f-1e2a193f4b35\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>codice_comune_istat</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>popolazione</th>\n","      <th>dato_riferito_a</th>\n","      <th>frazione_umida1_t</th>\n","      <th>verde_t</th>\n","      <th>carta_e_cartone_t</th>\n","      <th>vetro_t</th>\n","      <th>...</th>\n","      <th>pulizia_stradale_a_recupero_t</th>\n","      <th>ingombranti_misti_a_recupero_t</th>\n","      <th>altro_t</th>\n","      <th>raccolta_differenziata_tonnellate</th>\n","      <th>ingombranti_a_smaltimento_t</th>\n","      <th>indifferenziato_t</th>\n","      <th>totale_ru_t</th>\n","      <th>percentuale_rd</th>\n","      <th>anno</th>\n","      <th>istat_comune_6</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>01001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2621.0</td>\n","      <td>Comune</td>\n","      <td>255.275</td>\n","      <td>363.247</td>\n","      <td>92.683</td>\n","      <td>95.948</td>\n","      <td>...</td>\n","      <td>2.860</td>\n","      <td>34.280</td>\n","      <td>1.995</td>\n","      <td>1007.864</td>\n","      <td>NaN</td>\n","      <td>549.186</td>\n","      <td>1557.050</td>\n","      <td>64.73</td>\n","      <td>2019</td>\n","      <td>001001</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>01001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Airasca</td>\n","      <td>3598.0</td>\n","      <td>Comune</td>\n","      <td>174.489</td>\n","      <td>140.355</td>\n","      <td>239.377</td>\n","      <td>100.730</td>\n","      <td>...</td>\n","      <td>7.760</td>\n","      <td>110.507</td>\n","      <td>NaN</td>\n","      <td>1236.815</td>\n","      <td>NaN</td>\n","      <td>734.180</td>\n","      <td>1970.995</td>\n","      <td>62.75</td>\n","      <td>2019</td>\n","      <td>001002</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>01001003</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Ala Di Stura</td>\n","      <td>441.0</td>\n","      <td>Comune</td>\n","      <td>3.240</td>\n","      <td>13.450</td>\n","      <td>23.636</td>\n","      <td>26.368</td>\n","      <td>...</td>\n","      <td>NaN</td>\n","      <td>30.587</td>\n","      <td>0.005</td>\n","      <td>112.624</td>\n","      <td>NaN</td>\n","      <td>172.960</td>\n","      <td>285.584</td>\n","      <td>39.44</td>\n","      <td>2019</td>\n","      <td>001003</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>01001004</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Albiano D‚ÄôIvrea</td>\n","      <td>1644.0</td>\n","      <td>Comune</td>\n","      <td>175.768</td>\n","      <td>23.606</td>\n","      <td>67.644</td>\n","      <td>59.639</td>\n","      <td>...</td>\n","      <td>2.775</td>\n","      <td>12.448</td>\n","      <td>3.355</td>\n","      <td>503.335</td>\n","      <td>NaN</td>\n","      <td>192.089</td>\n","      <td>695.424</td>\n","      <td>72.38</td>\n","      <td>2019</td>\n","      <td>001004</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>01001006</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Almese</td>\n","      <td>6426.0</td>\n","      <td>Comune</td>\n","      <td>465.505</td>\n","      <td>1237.986</td>\n","      <td>352.661</td>\n","      <td>268.956</td>\n","      <td>...</td>\n","      <td>63.484</td>\n","      <td>96.568</td>\n","      <td>5.621</td>\n","      <td>2954.946</td>\n","      <td>NaN</td>\n","      <td>704.745</td>\n","      <td>3659.691</td>\n","      <td>80.74</td>\n","      <td>2019</td>\n","      <td>001006</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5 rows √ó 27 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-92f7c6e4-a888-4ca0-812f-1e2a193f4b35')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-92f7c6e4-a888-4ca0-812f-1e2a193f4b35 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-92f7c6e4-a888-4ca0-812f-1e2a193f4b35');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"df"}},"metadata":{},"execution_count":3}],"source":["# ======================\n","# NORMALIZZAZIONI MINIME\n","# ======================\n","\n","def norm_istat6(x):\n","    \"\"\"Normalizza codice ISTAT a 6 cifre (string).\"\"\"\n","    if pd.isna(x):\n","        return np.nan\n","    s = str(x).strip().replace(\".0\", \"\")\n","    s = \"\".join(ch for ch in s if ch.isdigit())\n","    if len(s) >= 8:\n","        s = s.zfill(8)[-6:]\n","    else:\n","        s = s.zfill(6)\n","    return s\n","\n","def clean_comune_name(s):\n","    \"\"\"Nome comune leggibile per Power BI (title case + unicode normalize).\"\"\"\n","    if pd.isna(s):\n","        return s\n","    s = str(s).strip()\n","    s = unicodedata.normalize(\"NFKC\", s)\n","    s = s.replace(\"'\", \"‚Äô\")\n","    # se capita roba tipo '??' (encoding rotto), la eliminiamo\n","    s = s.replace(\"??\", \"\")\n","    return s.title()\n","\n","# ---- mapping colonne (supporta naming diversi) ----\n","# Cerca una colonna ISTAT\n","istat_col = None\n","for c in [\"istat_comune_6\", \"codice_comune_istat\", \"istat_comune\", \"IstatComune\"]:\n","    if c in df.columns:\n","        istat_col = c\n","        break\n","if istat_col is None:\n","    raise KeyError(\"Non trovo una colonna ISTAT (istat_comune_6 / codice_comune_istat / ...).\")\n","\n","# RU totali (t)\n","if \"totale_ru_t\" not in df.columns:\n","    if \"rifiuti_urbani_tonnellate\" in df.columns:\n","        df = df.rename(columns={\"rifiuti_urbani_tonnellate\": \"totale_ru_t\"})\n","    elif \"Totale RU (t)\" in df.columns:\n","        df = df.rename(columns={\"Totale RU (t)\": \"totale_ru_t\"})\n","\n","# RD%\n","if \"percentuale_rd\" not in df.columns:\n","    if \"raccolta_differenziata_perc\" in df.columns:\n","        df = df.rename(columns={\"raccolta_differenziata_perc\": \"percentuale_rd\"})\n","    elif \"Percentuale RD (%)\" in df.columns:\n","        df = df.rename(columns={\"Percentuale RD (%)\": \"percentuale_rd\"})\n","\n","needed = [\"anno\",\"comune\",\"provincia\",\"regione\",\"popolazione\",\"totale_ru_t\",\"percentuale_rd\"]\n","missing = [c for c in needed if c not in df.columns]\n","if missing:\n","    raise KeyError(f\"Colonne mancanti nel CLEAN: {missing}\")\n","\n","df[\"istat_comune_6\"] = df[istat_col].map(norm_istat6)\n","df[\"comune\"] = df[\"comune\"].map(clean_comune_name)\n","\n","# RU pro capite (kg/abitante)\n","# ru_pro_capite_kg viene calcolato DOPO le aggregazioni (non qui)\n","\n","df.head()\n"]},{"cell_type":"markdown","id":"affa1bcc","metadata":{"id":"affa1bcc"},"source":["## Approfondimento: serie storica 2019‚Äì2023 (per Power BI)\n","\n","Questo output **non sostituisce** il MART 2020‚Äì2023: lo affianca.\n","Serve per visualizzare l‚Äôevoluzione annuale di RD% e rifiuti (totali e pro capite),\n","per capire se i cambiamenti sono **graduali**, **discontinui** o legati a specifici anni.\n"]},{"cell_type":"code","execution_count":null,"id":"5a0e4a9e","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":365},"id":"5a0e4a9e","outputId":"43fadb18-245d-4125-fbc7-f0ba1e817533","executionInfo":{"status":"ok","timestamp":1771314197609,"user_tz":-60,"elapsed":1217,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Serie storica righe: 38631\n","Anni presenti: [2019, 2020, 2021, 2022, 2023]\n","Duplicati (istat, anno): 0\n","NaN% RD: 0.0\n","NaN% RU: 0.0\n","‚úÖ Saved SERIE CSV: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/serie_comuni_rd_ru_2019_2023.csv\n","‚úÖ Saved SERIE Parquet - 2 files: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/serie_comuni_rd_ru_2019_2023.parquet\n","üìù Saved META SERIE: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/_meta/serie_comuni_rd_ru_2019_2023.meta.json\n"]},{"output_type":"execute_result","data":{"text/plain":["  istat_comune_6   regione provincia  comune  anno  popolazione  totale_ru_t  \\\n","0         001001  Piemonte    Torino  Aglie‚Äô  2019       2621.0     1557.050   \n","1         001001  Piemonte    Torino  Aglie‚Äô  2020       2548.0     1563.893   \n","2         001001  Piemonte    Torino  Aglie‚Äô  2021       2549.0     1409.963   \n","3         001001  Piemonte    Torino  Aglie‚Äô  2022       2558.0     1415.399   \n","4         001001  Piemonte    Torino  Aglie‚Äô  2023       2603.0     1330.664   \n","\n","   percentuale_rd  ru_pro_capite_kg  rd_disponibile  ru_disponibile  \n","0           64.73        594.067150            True            True  \n","1           66.64        613.772763            True            True  \n","2           62.21        553.143586            True            True  \n","3           65.68        553.322518            True            True  \n","4           62.61        511.203995            True            True  "],"text/html":["\n","  <div id=\"df-998ce09d-13c9-4b5f-a5d2-b2e20fa892b1\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>istat_comune_6</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>anno</th>\n","      <th>popolazione</th>\n","      <th>totale_ru_t</th>\n","      <th>percentuale_rd</th>\n","      <th>ru_pro_capite_kg</th>\n","      <th>rd_disponibile</th>\n","      <th>ru_disponibile</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2019</td>\n","      <td>2621.0</td>\n","      <td>1557.050</td>\n","      <td>64.73</td>\n","      <td>594.067150</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2020</td>\n","      <td>2548.0</td>\n","      <td>1563.893</td>\n","      <td>66.64</td>\n","      <td>613.772763</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2021</td>\n","      <td>2549.0</td>\n","      <td>1409.963</td>\n","      <td>62.21</td>\n","      <td>553.143586</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2022</td>\n","      <td>2558.0</td>\n","      <td>1415.399</td>\n","      <td>65.68</td>\n","      <td>553.322518</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2023</td>\n","      <td>2603.0</td>\n","      <td>1330.664</td>\n","      <td>62.61</td>\n","      <td>511.203995</td>\n","      <td>True</td>\n","      <td>True</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-998ce09d-13c9-4b5f-a5d2-b2e20fa892b1')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-998ce09d-13c9-4b5f-a5d2-b2e20fa892b1 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-998ce09d-13c9-4b5f-a5d2-b2e20fa892b1');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"series","summary":"{\n  \"name\": \"series\",\n  \"rows\": 38631,\n  \"fields\": [\n    {\n      \"column\": \"istat_comune_6\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 7799,\n        \"samples\": [\n          \"023070\",\n          \"068013\",\n          \"022184\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"regione\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 20,\n        \"samples\": [\n          \"Piemonte\",\n          \"Calabria\",\n          \"Puglia\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"provincia\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 107,\n        \"samples\": [\n          \"Matera\",\n          \"La Spezia\",\n          \"Asti\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"comune\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 7808,\n        \"samples\": [\n          \"Monsano\",\n          \"Mairago\",\n          \"Acquaformosa\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"anno\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 1,\n        \"min\": 2019,\n        \"max\": 2023,\n        \"num_unique_values\": 5,\n        \"samples\": [\n          2020,\n          2023,\n          2021\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"popolazione\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 42314.52265580413,\n        \"min\": 29.0,\n        \"max\": 2808293.0,\n        \"num_unique_values\": 13449,\n        \"samples\": [\n          6866.0,\n          17756.0,\n          999.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 23377.930322093067,\n        \"min\": 9.685,\n        \"max\": 1691887.319,\n        \"num_unique_values\": 38279,\n        \"samples\": [\n          227.85,\n          3082.587,\n          3744.313\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 17.298454975115785,\n        \"min\": 0.0,\n        \"max\": 100.0,\n        \"num_unique_values\": 7206,\n        \"samples\": [\n          86.43,\n          69.98,\n          31.28\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 171.2811311646301,\n        \"min\": 41.03813559322034,\n        \"max\": 3385.034766697164,\n        \"num_unique_values\": 38618,\n        \"samples\": [\n          459.24459432652253,\n          552.6720812182741,\n          357.7400614652523\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rd_disponibile\",\n      \"properties\": {\n        \"dtype\": \"boolean\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          false,\n          true\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_disponibile\",\n      \"properties\": {\n        \"dtype\": \"boolean\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          true\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":5}],"source":["# ======================\n","# SERIE STORICA 2019‚Äì2023 (LONG) ‚Äî Esportazione  POWER BI\n","# ======================\n","YEARS_SERIES = [2019, 2020, 2021, 2022, 2023]\n","\n","series = df[df[\"anno\"].isin(YEARS_SERIES)].copy()\n","\n","keys = [\"istat_comune_6\", \"regione\", \"provincia\", \"comune\"]\n","\n","# consolidiamo eventuali duplicati (1 riga per comune-anno)\n","series = series.groupby(keys + [\"anno\"], as_index=False).agg({\n","    \"popolazione\": \"sum\",  # sum non mean (se ci sono duplicati vanno sommati)\n","    \"totale_ru_t\": \"sum\",\n","    \"percentuale_rd\": \"mean\",\n","})\n","\n","# Calcola ru_pro_capite_kg DOPO l'aggregazione\n","series[\"ru_pro_capite_kg\"] = (series[\"totale_ru_t\"] * 1000) / series[\"popolazione\"]\n","\n","# rinomina colonne ‚Äúfriendly‚Äù\n","series = series.rename(columns={\n","    \"percentuale_rd\": \"percentuale_rd\",\n","    \"totale_ru_t\": \"totale_ru_t\",\n","    \"ru_pro_capite_kg\": \"ru_pro_capite_kg\",\n","})\n","\n","# Rimuove NaN e infiniti (se ci sono) ‚Äî> Power BI non li gestisce bene\n","series[\"rd_disponibile\"] = series[\"percentuale_rd\"].notna()\n","series[\"ru_disponibile\"] = series[\"totale_ru_t\"].notna()\n","series[\"percentuale_rd\"] = series[\"percentuale_rd\"].fillna(0)\n","series[\"totale_ru_t\"] = series[\"totale_ru_t\"].fillna(0)\n","series[\"ru_pro_capite_kg\"] = series[\"ru_pro_capite_kg\"].fillna(0)\n","\n","# QA rapido serie\n","print(\"Serie storica righe:\", series.shape[0])\n","print(\"Anni presenti:\", sorted(series[\"anno\"].unique().tolist()))\n","print(\"Duplicati (istat, anno):\", int(series.duplicated(subset=[\"istat_comune_6\",\"anno\"]).sum()))\n","print(\"NaN% RD:\", round(series[\"percentuale_rd\"].isna().mean()*100, 2))\n","print(\"NaN% RU:\", round(series[\"totale_ru_t\"].isna().mean()*100, 2))\n","\n","# ======================\n","# EXPORT SERIE STORICA 2019‚Äì2023 (Drive CSV & Parquet)\n","# ======================\n","\n","OUT_SERIE_CSV = os.path.join(\n","    MART_DOMAIN_DIR,\n","    \"serie_comuni_rd_ru_2019_2023.csv\"\n",")\n","\n","OUT_SERIE_PARQUET = os.path.join(\n","    MART_DOMAIN_DIR,\n","    \"serie_comuni_rd_ru_2019_2023.parquet\"\n",")\n","\n","# sicurezza extra Power BI\n","series = series.replace([np.inf, -np.inf], np.nan).fillna(0)\n","\n","# --- CSV (Power BI friendly) ---\n","series.to_csv(\n","    OUT_SERIE_CSV,\n","    index=False,\n","    sep=\";\",\n","    decimal=\",\",\n","    encoding=\"utf-8\"\n",")\n","\n","# --- Parquet (riuso tecnico) ---\n","series.to_parquet(\n","    OUT_SERIE_PARQUET,\n","    index=False\n",")\n","\n","# ======================\n","# META SERIE STORICA 2019‚Äì2023\n","# ======================\n","\n","import json\n","from datetime import datetime\n","\n","meta_series = {\n","    \"dataset\": \"serie_comuni_rd_ru_2019_2023\",\n","    \"years_series\": YEARS_SERIES,\n","    \"generated_at\": datetime.now().isoformat(),\n","    \"input_file\": str(CLEAN_FILE), # Converted PosixPath to string\n","    \"output_csv\": OUT_SERIE_CSV,\n","    \"output_parquet\": OUT_SERIE_PARQUET,\n","    \"rows\": int(series.shape[0]),\n","    \"columns\": list(series.columns)\n","}\n","\n","META_SERIE_FILE = os.path.join(\n","    META_DIR,\n","    \"serie_comuni_rd_ru_2019_2023.meta.json\"\n",")\n","\n","with open(META_SERIE_FILE, \"w\") as f:\n","    json.dump(meta_series, f, indent=4)\n","\n","print(\"‚úÖ Saved SERIE CSV:\", OUT_SERIE_CSV)\n","print(\"‚úÖ Saved SERIE Parquet - 2 files:\", OUT_SERIE_PARQUET)\n","print(\"üìù Saved META SERIE:\", META_SERIE_FILE)\n","\n","series.head()"]},{"cell_type":"code","execution_count":null,"id":"313fb770","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":261},"id":"313fb770","outputId":"38c0d0c3-b8ca-4d69-b803-63dd4e10334f","executionInfo":{"status":"ok","timestamp":1771314201312,"user_tz":-60,"elapsed":106,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Shape after groupby: (15479, 9)\n"]},{"output_type":"execute_result","data":{"text/plain":["  istat_comune_6   regione provincia        comune  anno  popolazione  \\\n","0         001001  Piemonte    Torino        Aglie‚Äô  2020       2548.0   \n","1         001001  Piemonte    Torino        Aglie‚Äô  2023       2603.0   \n","2         001002  Piemonte    Torino       Airasca  2020       3569.0   \n","3         001002  Piemonte    Torino       Airasca  2023       3686.0   \n","4         001003  Piemonte    Torino  Ala Di Stura  2020        448.0   \n","\n","   totale_ru_t  percentuale_rd  ru_pro_capite_kg  \n","0     1563.893           66.64        613.772763  \n","1     1330.664           62.61        511.203995  \n","2     2032.627           61.69        569.522836  \n","3     1806.090           72.24        489.986435  \n","4      369.621           38.50        825.046875  "],"text/html":["\n","  <div id=\"df-c50f4720-55b0-427b-b6e8-bd749c03b3c9\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>istat_comune_6</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>anno</th>\n","      <th>popolazione</th>\n","      <th>totale_ru_t</th>\n","      <th>percentuale_rd</th>\n","      <th>ru_pro_capite_kg</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2020</td>\n","      <td>2548.0</td>\n","      <td>1563.893</td>\n","      <td>66.64</td>\n","      <td>613.772763</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>2023</td>\n","      <td>2603.0</td>\n","      <td>1330.664</td>\n","      <td>62.61</td>\n","      <td>511.203995</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Airasca</td>\n","      <td>2020</td>\n","      <td>3569.0</td>\n","      <td>2032.627</td>\n","      <td>61.69</td>\n","      <td>569.522836</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Airasca</td>\n","      <td>2023</td>\n","      <td>3686.0</td>\n","      <td>1806.090</td>\n","      <td>72.24</td>\n","      <td>489.986435</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>001003</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Ala Di Stura</td>\n","      <td>2020</td>\n","      <td>448.0</td>\n","      <td>369.621</td>\n","      <td>38.50</td>\n","      <td>825.046875</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c50f4720-55b0-427b-b6e8-bd749c03b3c9')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-c50f4720-55b0-427b-b6e8-bd749c03b3c9 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-c50f4720-55b0-427b-b6e8-bd749c03b3c9');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"d","summary":"{\n  \"name\": \"d\",\n  \"rows\": 15479,\n  \"fields\": [\n    {\n      \"column\": \"istat_comune_6\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7779,\n        \"samples\": [\n          \"111004\",\n          \"023063\",\n          \"063086\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"regione\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 20,\n        \"samples\": [\n          \"Piemonte\",\n          \"Calabria\",\n          \"Puglia\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"provincia\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 107,\n        \"samples\": [\n          \"Matera\",\n          \"La Spezia\",\n          \"Asti\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"comune\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7788,\n        \"samples\": [\n          \"Suello\",\n          \"Cornedo All\\u2019Isarco\",\n          \"Comerio\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"anno\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 1,\n        \"min\": 2020,\n        \"max\": 2023,\n        \"num_unique_values\": 2,\n        \"samples\": [\n          2023,\n          2020\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"popolazione\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 42269.6361343773,\n        \"min\": 29.0,\n        \"max\": 2783809.0,\n        \"num_unique_values\": 8147,\n        \"samples\": [\n          6538.0,\n          4685.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 22862.738707269113,\n        \"min\": 15.01,\n        \"max\": 1601781.258,\n        \"num_unique_values\": 15429,\n        \"samples\": [\n          800.926,\n          204.777\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 16.67717961644852,\n        \"min\": 0.06,\n        \"max\": 100.0,\n        \"num_unique_values\": 5459,\n        \"samples\": [\n          69.58,\n          80.52\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 170.908428889179,\n        \"min\": 113.4412265758092,\n        \"max\": 3385.034766697164,\n        \"num_unique_values\": 15475,\n        \"samples\": [\n          537.3399209486166,\n          338.82011482032743\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":6}],"source":["# ======================\n","# FILTRO ANNI E AGGREGAZIONE (1 riga per comune-anno)\n","# ======================\n","Y0 = 2020\n","Y1 = 2023\n","d = df[df[\"anno\"].isin([Y0, Y1])].copy()\n","\n","keys = [\"istat_comune_6\",\"regione\",\"provincia\",\"comune\"]\n","\n","# In caso di duplicati (pu√≤ capitare per frazioni / righe non-comune), consolidiamo\n","d = d.groupby(keys + [\"anno\"], as_index=False).agg({\n","    \"popolazione\": \"sum\",  # sum non mean\n","    \"totale_ru_t\": \"sum\",\n","    \"percentuale_rd\": \"mean\",\n","})\n","\n","# Calcola ru_pro_capite_kg DOPO l'aggregazione\n","d[\"ru_pro_capite_kg\"] = (d[\"totale_ru_t\"] * 1000) / d[\"popolazione\"]\n","\n","print(\"Shape after groupby:\", d.shape)\n","d.head()\n"]},{"cell_type":"code","execution_count":null,"id":"a325a4c9","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":261},"id":"a325a4c9","outputId":"38dc4847-24b8-424e-b719-556953202494","executionInfo":{"status":"ok","timestamp":1771314204134,"user_tz":-60,"elapsed":140,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  istat_comune_6   regione provincia           comune  percentuale_rd_2020  \\\n","0         001001  Piemonte    Torino           Aglie‚Äô                66.64   \n","1         001002  Piemonte    Torino          Airasca                61.69   \n","2         001003  Piemonte    Torino     Ala Di Stura                38.50   \n","3         001004  Piemonte    Torino  Albiano D‚ÄôIvrea                70.82   \n","4         001006  Piemonte    Torino           Almese                79.49   \n","\n","   percentuale_rd_2023  popolazione_2020  popolazione_2023  \\\n","0                62.61            2548.0            2603.0   \n","1                72.24            3569.0            3686.0   \n","2                44.92             448.0             473.0   \n","3                80.69            1650.0            1619.0   \n","4                77.32            6448.0            6323.0   \n","\n","   ru_pro_capite_kg_2020  ru_pro_capite_kg_2023  totale_ru_t_2020  \\\n","0             613.772763             511.203995          1563.893   \n","1             569.522836             489.986435          2032.627   \n","2             825.046875             732.786469           369.621   \n","3             411.358788             437.741198           678.742   \n","4             596.065602             568.449154          3843.431   \n","\n","   totale_ru_t_2023  delta_rd_pp  delta_ru_totali_t  delta_ru_pro_capite  \n","0          1330.664        -4.03           -233.229          -102.568768  \n","1          1806.090        10.55           -226.537           -79.536400  \n","2           346.608         6.42            -23.013           -92.260406  \n","3           708.703         9.87             29.961            26.382410  \n","4          3594.304        -2.17           -249.127           -27.616448  "],"text/html":["\n","  <div id=\"df-0599dda0-456a-436b-8e1c-2abfb444a7d1\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>istat_comune_6</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>percentuale_rd_2020</th>\n","      <th>percentuale_rd_2023</th>\n","      <th>popolazione_2020</th>\n","      <th>popolazione_2023</th>\n","      <th>ru_pro_capite_kg_2020</th>\n","      <th>ru_pro_capite_kg_2023</th>\n","      <th>totale_ru_t_2020</th>\n","      <th>totale_ru_t_2023</th>\n","      <th>delta_rd_pp</th>\n","      <th>delta_ru_totali_t</th>\n","      <th>delta_ru_pro_capite</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>66.64</td>\n","      <td>62.61</td>\n","      <td>2548.0</td>\n","      <td>2603.0</td>\n","      <td>613.772763</td>\n","      <td>511.203995</td>\n","      <td>1563.893</td>\n","      <td>1330.664</td>\n","      <td>-4.03</td>\n","      <td>-233.229</td>\n","      <td>-102.568768</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Airasca</td>\n","      <td>61.69</td>\n","      <td>72.24</td>\n","      <td>3569.0</td>\n","      <td>3686.0</td>\n","      <td>569.522836</td>\n","      <td>489.986435</td>\n","      <td>2032.627</td>\n","      <td>1806.090</td>\n","      <td>10.55</td>\n","      <td>-226.537</td>\n","      <td>-79.536400</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>001003</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Ala Di Stura</td>\n","      <td>38.50</td>\n","      <td>44.92</td>\n","      <td>448.0</td>\n","      <td>473.0</td>\n","      <td>825.046875</td>\n","      <td>732.786469</td>\n","      <td>369.621</td>\n","      <td>346.608</td>\n","      <td>6.42</td>\n","      <td>-23.013</td>\n","      <td>-92.260406</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>001004</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Albiano D‚ÄôIvrea</td>\n","      <td>70.82</td>\n","      <td>80.69</td>\n","      <td>1650.0</td>\n","      <td>1619.0</td>\n","      <td>411.358788</td>\n","      <td>437.741198</td>\n","      <td>678.742</td>\n","      <td>708.703</td>\n","      <td>9.87</td>\n","      <td>29.961</td>\n","      <td>26.382410</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>001006</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Almese</td>\n","      <td>79.49</td>\n","      <td>77.32</td>\n","      <td>6448.0</td>\n","      <td>6323.0</td>\n","      <td>596.065602</td>\n","      <td>568.449154</td>\n","      <td>3843.431</td>\n","      <td>3594.304</td>\n","      <td>-2.17</td>\n","      <td>-249.127</td>\n","      <td>-27.616448</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0599dda0-456a-436b-8e1c-2abfb444a7d1')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-0599dda0-456a-436b-8e1c-2abfb444a7d1 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-0599dda0-456a-436b-8e1c-2abfb444a7d1');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"w","summary":"{\n  \"name\": \"w\",\n  \"rows\": 7797,\n  \"fields\": [\n    {\n      \"column\": \"istat_comune_6\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7779,\n        \"samples\": [\n          \"111004\",\n          \"023063\",\n          \"063086\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"regione\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 20,\n        \"samples\": [\n          \"Piemonte\",\n          \"Calabria\",\n          \"Puglia\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"provincia\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 107,\n        \"samples\": [\n          \"Matera\",\n          \"La Spezia\",\n          \"Asti\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"comune\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7788,\n        \"samples\": [\n          \"Suello\",\n          \"Cornedo All\\u2019Isarco\",\n          \"Comerio\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 17.56696062286266,\n        \"min\": 0.18,\n        \"max\": 100.0,\n        \"num_unique_values\": 4111,\n        \"samples\": [\n          63.58,\n          75.97,\n          77.86\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 15.59399682747447,\n        \"min\": 0.06,\n        \"max\": 99.92,\n        \"num_unique_values\": 3941,\n        \"samples\": [\n          76.12,\n          64.72,\n          41.38\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"popolazione_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 42563.83258187792,\n        \"min\": 29.0,\n        \"max\": 2783809.0,\n        \"num_unique_values\": 5213,\n        \"samples\": [\n          2286.0,\n          1360.0,\n          1718.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"popolazione_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 41977.66339300225,\n        \"min\": 34.0,\n        \"max\": 2754719.0,\n        \"num_unique_values\": 5195,\n        \"samples\": [\n          1898.0,\n          1514.0,\n          13407.0\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 160.3891642955914,\n        \"min\": 123.08966009456687,\n        \"max\": 2259.118847006652,\n        \"num_unique_values\": 7717,\n        \"samples\": [\n          677.7055279014933,\n          524.5379609544468,\n          504.736774907435\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 180.71423469960052,\n        \"min\": 113.4412265758092,\n        \"max\": 3385.034766697164,\n        \"num_unique_values\": 7758,\n        \"samples\": [\n          672.397825668655,\n          528.8847926267281,\n          600.8058721934369\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 22438.157342832706,\n        \"min\": 15.01,\n        \"max\": 1529044.398,\n        \"num_unique_values\": 7708,\n        \"samples\": [\n          296.7,\n          197.045,\n          1669.37\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 23278.83596827832,\n        \"min\": 18.06,\n        \"max\": 1601781.258,\n        \"num_unique_values\": 7746,\n        \"samples\": [\n          1666.602,\n          99.628,\n          360.284\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_rd_pp\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 10.40037491467826,\n        \"min\": -54.17,\n        \"max\": 80.31,\n        \"num_unique_values\": 4106,\n        \"samples\": [\n          20.810000000000002,\n          -3.8799999999999955,\n          10.340000000000003\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_ru_totali_t\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 1288.4215648806014,\n        \"min\": -26727.42300000001,\n        \"max\": 72736.85999999987,\n        \"num_unique_values\": 7656,\n        \"samples\": [\n          21.699999999999932,\n          -46.41300000000001,\n          -148.70499999999993\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_ru_pro_capite\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 85.26627385464721,\n        \"min\": -1259.1942594043887,\n        \"max\": 1355.0146238043353,\n        \"num_unique_values\": 7682,\n        \"samples\": [\n          26.20659908566887,\n          5.2921597183822655,\n          56.392071991312946\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":7}],"source":["# ======================\n","# WIDE 2020 vs 2023 + DELTA\n","# ======================\n","w = d.pivot_table(\n","    index=keys,\n","    columns=\"anno\",\n","    values=[\"percentuale_rd\",\"totale_ru_t\",\"ru_pro_capite_kg\",\"popolazione\"],\n","    aggfunc=\"first\"\n",").reset_index()\n","\n","# flatten columns\n","w.columns = [\n","    f\"{a}_{b}\" if isinstance(b, (int, np.integer)) else a\n","    for a, b in w.columns\n","]\n","\n","# rename convenience\n","w = w.rename(columns={\n","    f\"percentuale_rd_{Y0}\": f\"percentuale_rd_{Y0}\",\n","    f\"percentuale_rd_{Y1}\": f\"percentuale_rd_{Y1}\",\n","    f\"totale_ru_t_{Y0}\": f\"totale_ru_t_{Y0}\",\n","    f\"totale_ru_t_{Y1}\": f\"totale_ru_t_{Y1}\",\n","    f\"ru_pro_capite_kg_{Y0}\": f\"ru_pro_capite_kg_{Y0}\",\n","    f\"ru_pro_capite_kg_{Y1}\": f\"ru_pro_capite_kg_{Y1}\",\n","    f\"popolazione_{Y0}\": f\"popolazione_{Y0}\",\n","    f\"popolazione_{Y1}\": f\"popolazione_{Y1}\",\n","})\n","\n","# deltas\n","w[\"delta_rd_pp\"] = w[f\"percentuale_rd_{Y1}\"] - w[f\"percentuale_rd_{Y0}\"]\n","w[\"delta_ru_totali_t\"] = w[f\"totale_ru_t_{Y1}\"] - w[f\"totale_ru_t_{Y0}\"]\n","w[\"delta_ru_pro_capite\"] = w[f\"ru_pro_capite_kg_{Y1}\"] - w[f\"ru_pro_capite_kg_{Y0}\"]\n","\n","w.head()\n"]},{"cell_type":"code","execution_count":null,"id":"013757ed","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":450},"id":"013757ed","outputId":"3887729e-865a-4c5a-c179-51ca735913c5","executionInfo":{"status":"ok","timestamp":1771314207327,"user_tz":-60,"elapsed":100,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["            comune  delta_rd_pp  delta_ru_totali_t  rd_su_rifiuti_su  \\\n","0           Aglie‚Äô        -4.03           -233.229             False   \n","1          Airasca        10.55           -226.537             False   \n","2     Ala Di Stura         6.42            -23.013             False   \n","3  Albiano D‚ÄôIvrea         9.87             29.961              True   \n","4           Almese        -2.17           -249.127             False   \n","5          Alpette        -1.38              1.821             False   \n","6        Alpignano         2.15            559.728              True   \n","7         Andezeno         4.69            -32.255             False   \n","8          Andrate         5.40              3.301              True   \n","9         Angrogna        -0.58              0.045             False   \n","\n","                              quadrante  \n","0        Riduce RU ma non RD (RD‚Üì, RU‚Üì)  \n","1                   Virtuosi (RD‚Üë, RU‚Üì)  \n","2                   Virtuosi (RD‚Üë, RU‚Üì)  \n","3  Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)  \n","4        Riduce RU ma non RD (RD‚Üì, RU‚Üì)  \n","5          Peggiora entrambi (RD‚Üì, RU‚Üë)  \n","6  Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)  \n","7                   Virtuosi (RD‚Üë, RU‚Üì)  \n","8  Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)  \n","9          Peggiora entrambi (RD‚Üì, RU‚Üë)  "],"text/html":["\n","  <div id=\"df-77848377-6509-45e4-ae2c-874e1fb2e91f\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>comune</th>\n","      <th>delta_rd_pp</th>\n","      <th>delta_ru_totali_t</th>\n","      <th>rd_su_rifiuti_su</th>\n","      <th>quadrante</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>Aglie‚Äô</td>\n","      <td>-4.03</td>\n","      <td>-233.229</td>\n","      <td>False</td>\n","      <td>Riduce RU ma non RD (RD‚Üì, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Airasca</td>\n","      <td>10.55</td>\n","      <td>-226.537</td>\n","      <td>False</td>\n","      <td>Virtuosi (RD‚Üë, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Ala Di Stura</td>\n","      <td>6.42</td>\n","      <td>-23.013</td>\n","      <td>False</td>\n","      <td>Virtuosi (RD‚Üë, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Albiano D‚ÄôIvrea</td>\n","      <td>9.87</td>\n","      <td>29.961</td>\n","      <td>True</td>\n","      <td>Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Almese</td>\n","      <td>-2.17</td>\n","      <td>-249.127</td>\n","      <td>False</td>\n","      <td>Riduce RU ma non RD (RD‚Üì, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>Alpette</td>\n","      <td>-1.38</td>\n","      <td>1.821</td>\n","      <td>False</td>\n","      <td>Peggiora entrambi (RD‚Üì, RU‚Üë)</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>Alpignano</td>\n","      <td>2.15</td>\n","      <td>559.728</td>\n","      <td>True</td>\n","      <td>Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>Andezeno</td>\n","      <td>4.69</td>\n","      <td>-32.255</td>\n","      <td>False</td>\n","      <td>Virtuosi (RD‚Üë, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>Andrate</td>\n","      <td>5.40</td>\n","      <td>3.301</td>\n","      <td>True</td>\n","      <td>Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>Angrogna</td>\n","      <td>-0.58</td>\n","      <td>0.045</td>\n","      <td>False</td>\n","      <td>Peggiora entrambi (RD‚Üì, RU‚Üë)</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-77848377-6509-45e4-ae2c-874e1fb2e91f')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-77848377-6509-45e4-ae2c-874e1fb2e91f button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-77848377-6509-45e4-ae2c-874e1fb2e91f');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"w[[\\\"comune\\\",\\\"delta_rd_pp\\\",\\\"delta_ru_totali_t\\\",\\\"rd_su_rifiuti_su\\\",\\\"quadrante\\\"]]\",\n  \"rows\": 10,\n  \"fields\": [\n    {\n      \"column\": \"comune\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 10,\n        \"samples\": [\n          \"Andrate\",\n          \"Airasca\",\n          \"Alpette\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_rd_pp\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 5.091390990900446,\n        \"min\": -4.030000000000001,\n        \"max\": 10.549999999999997,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          5.399999999999999,\n          10.549999999999997,\n          -1.3799999999999955\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_ru_totali_t\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 231.10601607691748,\n        \"min\": -249.12699999999995,\n        \"max\": 559.7280000000001,\n        \"num_unique_values\": 10,\n        \"samples\": [\n          3.301000000000016,\n          -226.53700000000003,\n          1.820999999999998\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rd_su_rifiuti_su\",\n      \"properties\": {\n        \"dtype\": \"boolean\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          true,\n          false\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"quadrante\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 4,\n        \"samples\": [\n          \"Virtuosi (RD\\u2191, RU\\u2193)\",\n          \"Peggiora entrambi (RD\\u2193, RU\\u2191)\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":8}],"source":["# ======================\n","# CLASSIFICAZIONE (quadranti) + FLAG DOMANDA CIVICA\n","# ======================\n","\n","def quadrante(delta_rd_pp, delta_ru_tot):\n","    if pd.isna(delta_rd_pp) or pd.isna(delta_ru_tot):\n","        return \"Dati mancanti\"\n","    if delta_rd_pp > 0 and delta_ru_tot <= 0:\n","        return \"Virtuosi (RD‚Üë, RU‚Üì)\"\n","    if delta_rd_pp > 0 and delta_ru_tot > 0:\n","        return \"Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)\"\n","    if delta_rd_pp <= 0 and delta_ru_tot <= 0:\n","        return \"Riduce RU ma non RD (RD‚Üì, RU‚Üì)\"\n","    return \"Peggiora entrambi (RD‚Üì, RU‚Üë)\"\n","\n","w[\"quadrante\"] = w.apply(lambda r: quadrante(r[\"delta_rd_pp\"], r[\"delta_ru_totali_t\"]), axis=1)\n","\n","# Flag che risponde direttamente alla domanda civica:\n","w[\"rd_su_rifiuti_su\"] = (w[\"delta_rd_pp\"] > 0) & (w[\"delta_ru_totali_t\"] > 0)\n","\n","# (Opzionale) Virtuoso strutturale: RD‚Üë e RU pro capite ‚Üì\n","w[\"virtuoso_strutturale\"] = (w[\"delta_rd_pp\"] > 0) & (w[\"delta_ru_pro_capite\"] < 0)\n","\n","w[[\"comune\",\"delta_rd_pp\",\"delta_ru_totali_t\",\"rd_su_rifiuti_su\",\"quadrante\"]].head(10)\n"]},{"cell_type":"code","execution_count":null,"id":"115727d6","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"115727d6","outputId":"602bb3c8-a053-4b4c-919e-9b6a0c2c0df5","executionInfo":{"status":"ok","timestamp":1771314210725,"user_tz":-60,"elapsed":57,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Righe prima: 7797\n","Righe dopo : 7779\n","Duplicati rimossi: 18\n"]}],"source":["# ======================\n","# DEDUPLICAZIONE (1 riga per istat_comune_6)\n","# ======================\n","# In alcuni casi ISPRA pu√≤ avere pi√π righe con lo stesso codice ISTAT.\n","# Per il MART Power BI vogliamo 1 riga = 1 comune.\n","# Regola: teniamo la riga con popolazione 2023 pi√π alta (pi√π \"affidabile\" nei merge).\n","\n","before = len(w)\n","\n","pop_col = f\"popolazione_{Y1}\"\n","if pop_col not in w.columns:\n","    # fallback: se manca (non dovrebbe), deduplica senza criterio\n","    w_dedup = w.drop_duplicates(subset=[\"istat_comune_6\"], keep=\"first\").copy()\n","else:\n","    w_dedup = (\n","        w.sort_values(by=[\"istat_comune_6\", pop_col], ascending=[True, False])\n","         .drop_duplicates(subset=[\"istat_comune_6\"], keep=\"first\")\n","         .reset_index(drop=True)\n","    )\n","\n","after = len(w_dedup)\n","print(\"Righe prima:\", before)\n","print(\"Righe dopo :\", after)\n","print(\"Duplicati rimossi:\", before - after)\n","\n","# Da qui in avanti usiamo SEMPRE w_final\n","w_final = w_dedup\n"]},{"cell_type":"code","execution_count":null,"id":"0f3e8e72","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0f3e8e72","outputId":"d054091e-4df6-4a1f-bfd2-eb02731f3b96","executionInfo":{"status":"ok","timestamp":1771314213896,"user_tz":-60,"elapsed":44,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Comuni (righe): 7779\n","Quota RD‚Üë & RU‚Üë (totali): 30.737 %\n","N RD‚Üë & RU‚Üë: 2391\n","N virtuosi strutturali (RD‚Üë & RU_pc‚Üì): 1913\n","Duplicati per istat_comune_6: 0\n","RD% min/max 2020: 0.18 100.0\n","RD% min/max 2023: 0.06 99.92\n"]}],"source":["# ======================\n","# QA MINIMO\n","# ======================\n","print(\"Comuni (righe):\", len(w_final))\n","print(\"Quota RD‚Üë & RU‚Üë (totali):\", round(w_final[\"rd_su_rifiuti_su\"].mean()*100, 3), \"%\")\n","print(\"N RD‚Üë & RU‚Üë:\", int(w_final[\"rd_su_rifiuti_su\"].sum()))\n","print(\"N virtuosi strutturali (RD‚Üë & RU_pc‚Üì):\", int(w_final[\"virtuoso_strutturale\"].sum()))\n","\n","# Duplicati chiave\n","dup = w_final.duplicated(subset=[\"istat_comune_6\"]).sum()\n","print(\"Duplicati per istat_comune_6:\", int(dup))\n","\n","# Range RD\n","print(\"RD% min/max 2020:\", float(w_final[f\"percentuale_rd_{Y0}\"].min()), float(w_final[f\"percentuale_rd_{Y0}\"].max()))\n","print(\"RD% min/max 2023:\", float(w_final[f\"percentuale_rd_{Y1}\"].min()), float(w_final[f\"percentuale_rd_{Y1}\"].max()))\n"]},{"cell_type":"code","execution_count":null,"id":"e85ee8bd","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":521},"id":"e85ee8bd","outputId":"a4b4a9bf-5f66-4573-f41e-646621b36b77","executionInfo":{"status":"ok","timestamp":1771314226709,"user_tz":-60,"elapsed":403,"user":{"displayName":"Matteo Cavo","userId":"15727220103966895763"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["‚úÖ Saved MART CSV: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/mart_comuni_delta_2020_2023_dashboard.csv\n","‚úÖ Saved MART Parquet - 2 files: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/mart_comuni_delta_2020_2023_dashboard.parquet\n","üìù Saved META MART: /content/drive/MyDrive/DataCivicLab/data/mart/ispra_catasto_rifiuti/_meta/mart_comuni_delta_2020_2023_dashboard.meta.json\n"]},{"output_type":"execute_result","data":{"text/plain":["  istat_comune_6   regione provincia           comune  percentuale_rd_2020  \\\n","0         001001  Piemonte    Torino           Aglie‚Äô                66.64   \n","1         001002  Piemonte    Torino          Airasca                61.69   \n","2         001003  Piemonte    Torino     Ala Di Stura                38.50   \n","3         001004  Piemonte    Torino  Albiano D‚ÄôIvrea                70.82   \n","4         001006  Piemonte    Torino           Almese                79.49   \n","\n","   percentuale_rd_2023  delta_rd_pp  totale_ru_t_2020  totale_ru_t_2023  \\\n","0                62.61        -4.03          1563.893          1330.664   \n","1                72.24        10.55          2032.627          1806.090   \n","2                44.92         6.42           369.621           346.608   \n","3                80.69         9.87           678.742           708.703   \n","4                77.32        -2.17          3843.431          3594.304   \n","\n","   delta_ru_totali_t  ru_pro_capite_kg_2020  ru_pro_capite_kg_2023  \\\n","0           -233.229             613.772763             511.203995   \n","1           -226.537             569.522836             489.986435   \n","2            -23.013             825.046875             732.786469   \n","3             29.961             411.358788             437.741198   \n","4           -249.127             596.065602             568.449154   \n","\n","   delta_ru_pro_capite  rd_su_rifiuti_su  virtuoso_strutturale  \\\n","0          -102.568768             False                 False   \n","1           -79.536400             False                  True   \n","2           -92.260406             False                  True   \n","3            26.382410              True                 False   \n","4           -27.616448             False                 False   \n","\n","                              quadrante  \n","0        Riduce RU ma non RD (RD‚Üì, RU‚Üì)  \n","1                   Virtuosi (RD‚Üë, RU‚Üì)  \n","2                   Virtuosi (RD‚Üë, RU‚Üì)  \n","3  Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)  \n","4        Riduce RU ma non RD (RD‚Üì, RU‚Üì)  "],"text/html":["\n","  <div id=\"df-a8ccaf2f-d65a-4614-91c9-4f5585bfde58\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>istat_comune_6</th>\n","      <th>regione</th>\n","      <th>provincia</th>\n","      <th>comune</th>\n","      <th>percentuale_rd_2020</th>\n","      <th>percentuale_rd_2023</th>\n","      <th>delta_rd_pp</th>\n","      <th>totale_ru_t_2020</th>\n","      <th>totale_ru_t_2023</th>\n","      <th>delta_ru_totali_t</th>\n","      <th>ru_pro_capite_kg_2020</th>\n","      <th>ru_pro_capite_kg_2023</th>\n","      <th>delta_ru_pro_capite</th>\n","      <th>rd_su_rifiuti_su</th>\n","      <th>virtuoso_strutturale</th>\n","      <th>quadrante</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>001001</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Aglie‚Äô</td>\n","      <td>66.64</td>\n","      <td>62.61</td>\n","      <td>-4.03</td>\n","      <td>1563.893</td>\n","      <td>1330.664</td>\n","      <td>-233.229</td>\n","      <td>613.772763</td>\n","      <td>511.203995</td>\n","      <td>-102.568768</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>Riduce RU ma non RD (RD‚Üì, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>001002</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Airasca</td>\n","      <td>61.69</td>\n","      <td>72.24</td>\n","      <td>10.55</td>\n","      <td>2032.627</td>\n","      <td>1806.090</td>\n","      <td>-226.537</td>\n","      <td>569.522836</td>\n","      <td>489.986435</td>\n","      <td>-79.536400</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>Virtuosi (RD‚Üë, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>001003</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Ala Di Stura</td>\n","      <td>38.50</td>\n","      <td>44.92</td>\n","      <td>6.42</td>\n","      <td>369.621</td>\n","      <td>346.608</td>\n","      <td>-23.013</td>\n","      <td>825.046875</td>\n","      <td>732.786469</td>\n","      <td>-92.260406</td>\n","      <td>False</td>\n","      <td>True</td>\n","      <td>Virtuosi (RD‚Üë, RU‚Üì)</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>001004</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Albiano D‚ÄôIvrea</td>\n","      <td>70.82</td>\n","      <td>80.69</td>\n","      <td>9.87</td>\n","      <td>678.742</td>\n","      <td>708.703</td>\n","      <td>29.961</td>\n","      <td>411.358788</td>\n","      <td>437.741198</td>\n","      <td>26.382410</td>\n","      <td>True</td>\n","      <td>False</td>\n","      <td>Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë)</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>001006</td>\n","      <td>Piemonte</td>\n","      <td>Torino</td>\n","      <td>Almese</td>\n","      <td>79.49</td>\n","      <td>77.32</td>\n","      <td>-2.17</td>\n","      <td>3843.431</td>\n","      <td>3594.304</td>\n","      <td>-249.127</td>\n","      <td>596.065602</td>\n","      <td>568.449154</td>\n","      <td>-27.616448</td>\n","      <td>False</td>\n","      <td>False</td>\n","      <td>Riduce RU ma non RD (RD‚Üì, RU‚Üì)</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-a8ccaf2f-d65a-4614-91c9-4f5585bfde58')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-a8ccaf2f-d65a-4614-91c9-4f5585bfde58 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-a8ccaf2f-d65a-4614-91c9-4f5585bfde58');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"mart","summary":"{\n  \"name\": \"mart\",\n  \"rows\": 7779,\n  \"fields\": [\n    {\n      \"column\": \"istat_comune_6\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7779,\n        \"samples\": [\n          \"111004\",\n          \"023063\",\n          \"063086\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"regione\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 20,\n        \"samples\": [\n          \"Piemonte\",\n          \"Calabria\",\n          \"Puglia\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"provincia\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 107,\n        \"samples\": [\n          \"Matera\",\n          \"La Spezia\",\n          \"Asti\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"comune\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 7770,\n        \"samples\": [\n          \"Blessagno\",\n          \"Mezzolombardo\",\n          \"Pocenia\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 18.979871489503363,\n        \"min\": 0.0,\n        \"max\": 100.0,\n        \"num_unique_values\": 4110,\n        \"samples\": [\n          58.24,\n          41.32,\n          41.93\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"percentuale_rd_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 16.201869887468373,\n        \"min\": 0.0,\n        \"max\": 99.92,\n        \"num_unique_values\": 3942,\n        \"samples\": [\n          92.91,\n          84.02,\n          90.87\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_rd_pp\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 10.324766384084235,\n        \"min\": -54.17,\n        \"max\": 80.31,\n        \"num_unique_values\": 4106,\n        \"samples\": [\n          20.810000000000002,\n          -3.8799999999999955,\n          5.109999999999999\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 22354.05693954651,\n        \"min\": 0.0,\n        \"max\": 1529044.398,\n        \"num_unique_values\": 7691,\n        \"samples\": [\n          817.354,\n          2282.925,\n          363.49\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"totale_ru_t_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 23251.124336843503,\n        \"min\": 0.0,\n        \"max\": 1601781.258,\n        \"num_unique_values\": 7747,\n        \"samples\": [\n          3678.438,\n          8445.407,\n          621.801\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_ru_totali_t\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 1280.371057007352,\n        \"min\": -26727.42300000001,\n        \"max\": 72736.85999999987,\n        \"num_unique_values\": 7657,\n        \"samples\": [\n          -41.47000000000003,\n          -46.41300000000001,\n          -148.70499999999993\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg_2020\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 165.9015592545063,\n        \"min\": 0.0,\n        \"max\": 2259.118847006652,\n        \"num_unique_values\": 7701,\n        \"samples\": [\n          464.1749262536873,\n          264.7650897226754,\n          371.6041979010495\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"ru_pro_capite_kg_2023\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 181.9378749748275,\n        \"min\": 0.0,\n        \"max\": 3385.034766697164,\n        \"num_unique_values\": 7759,\n        \"samples\": [\n          548.8600672166208,\n          475.1457566356429,\n          596.5890322580645\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"delta_ru_pro_capite\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 84.73686552793109,\n        \"min\": -1259.1942594043887,\n        \"max\": 1355.0146238043353,\n        \"num_unique_values\": 7683,\n        \"samples\": [\n          -51.22369319808291,\n          324.9032522785443,\n          56.392071991312946\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"rd_su_rifiuti_su\",\n      \"properties\": {\n        \"dtype\": \"boolean\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          true,\n          false\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"virtuoso_strutturale\",\n      \"properties\": {\n        \"dtype\": \"boolean\",\n        \"num_unique_values\": 2,\n        \"samples\": [\n          true,\n          false\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"quadrante\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"Virtuosi (RD\\u2191, RU\\u2193)\",\n          \"Dati mancanti\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":12}],"source":["# ======================\n","# EXPORT MART DELTA 2020‚Äì2023 (Drive)\n","# ======================\n","\n","out_cols = [\n","    \"istat_comune_6\",\"regione\",\"provincia\",\"comune\",\n","    f\"percentuale_rd_{Y0}\", f\"percentuale_rd_{Y1}\", \"delta_rd_pp\",\n","    f\"totale_ru_t_{Y0}\", f\"totale_ru_t_{Y1}\", \"delta_ru_totali_t\",\n","    f\"ru_pro_capite_kg_{Y0}\", f\"ru_pro_capite_kg_{Y1}\", \"delta_ru_pro_capite\",\n","    \"rd_su_rifiuti_su\",\"virtuoso_strutturale\",\"quadrante\"\n","]\n","\n","mart = w_final[out_cols].copy()\n","\n","# Sicurezza Power BI\n","mart = mart.replace([np.inf, -np.inf], np.nan).fillna(0)\n","\n","OUT_DASHBOARD_CSV = os.path.join(\n","    MART_DOMAIN_DIR,\n","    \"mart_comuni_delta_2020_2023_dashboard.csv\"\n",")\n","\n","OUT_DASHBOARD_PARQUET = os.path.join(\n","    MART_DOMAIN_DIR,\n","    \"mart_comuni_delta_2020_2023_dashboard.parquet\"\n",")\n","\n","# --- CSV (Power BI ITA-friendly) ---\n","mart.to_csv(\n","    OUT_DASHBOARD_CSV,\n","    index=False,\n","    sep=\";\",\n","    decimal=\",\",\n","    encoding=\"utf-8\"\n",")\n","\n","# --- Parquet (riuso tecnico / BigQuery / analytics) ---\n","mart.to_parquet(\n","    OUT_DASHBOARD_PARQUET,\n","    index=False\n",")\n","\n","# ======================\n","# META MART DELTA 2020‚Äì2023\n","# ======================\n","\n","META_DIR = os.path.join(MART_DOMAIN_DIR, \"_meta\")\n","os.makedirs(META_DIR, exist_ok=True)\n","\n","meta_mart = {\n","    \"dataset\": \"mart_comuni_delta_2020_2023_dashboard\",\n","    \"years_delta\": [Y0, Y1],\n","    \"generated_at\": datetime.now().isoformat(),\n","    \"input_file\": str(CLEAN_FILE), # Convert PosixPath to string\n","    \"output_csv\": OUT_DASHBOARD_CSV,\n","    \"output_parquet\": OUT_DASHBOARD_PARQUET,\n","    \"rows\": int(mart.shape[0]),\n","    \"columns\": list(mart.columns)\n","}\n","\n","META_MART_FILE = os.path.join(\n","    META_DIR,\n","    \"mart_comuni_delta_2020_2023_dashboard.meta.json\"\n",")\n","\n","with open(META_MART_FILE, \"w\") as f:\n","    json.dump(meta_mart, f, indent=4)\n","\n","\n","print(\"‚úÖ Saved MART CSV:\", OUT_DASHBOARD_CSV)\n","print(\"‚úÖ Saved MART Parquet - 2 files:\", OUT_DASHBOARD_PARQUET)\n","print(\"üìù Saved META MART:\", META_MART_FILE)\n","\n","mart.head()\n"]},{"cell_type":"markdown","id":"8f97d863","metadata":{"id":"8f97d863"},"source":["# Analisi Rifiuti Urbani e Raccolta Differenziata (ISPRA 2020‚Äì2023)\n","\n","## Domanda Civica\n","\n","**Ci sono comuni che migliorano la raccolta differenziata ma aumentano i rifiuti totali?**\n","\n","**S√¨.** I dati ISPRA a livello comunale mostrano che il miglioramento della raccolta differenziata non implica automaticamente una riduzione dei rifiuti prodotti.\n","\n","---\n","\n","## Risultati Principali (2020‚Äì2023)\n","\n","| Indicatore | Valore |\n","|------------|--------|\n","| Comuni analizzati | **7.779** |\n","| Comuni con RD in aumento e rifiuti totali in aumento | **2.391 (30,7%)** |\n","| Comuni virtuosi strutturali (RD aumenta, RU pro capite diminuisce) | **1.913 (24,6%)** |\n","| RD media 2020 ‚Üí 2023 | **65,5% ‚Üí 69,1% (+3,1 pp)** |\n","| RU pro capite media 2020 ‚Üí 2023 | **452 ‚Üí 462 kg/ab (+7,3 kg/ab)** |\n","\n","---\n","\n","## Classificazione dei comuni per quadrante\n","\n","| Quadrante | Comuni |\n","|----------|--------|\n","| Migliora RD ma aumenta RU (RD‚Üë, RU‚Üë) | **2.391** |\n","| Virtuosi (RD‚Üë, RU‚Üì) | **2.097** |\n","| Riduce RU ma non RD (RD‚Üì, RU‚Üì) | **1.728** |\n","| Peggiora entrambi (RD‚Üì, RU‚Üë) | **1.439** |\n","| Dati mancanti | **124** |\n","\n","---\n","\n","##  Note Metodologiche\n","\n","- **Perch√© il confronto 2020‚Äì2023:** il confronto inizio‚Äìfine su un orizzonte triennale offre un segnale stabile per la classificazione dei comuni, riducendo il rumore dato da oscillazioni annuali.\n","- **Filtro dati aggregati:** il dataset esclude i record ISPRA con `Dato riferito a` diverso da `\"Comune\"`. Per i dettagli vedere la documentazione in fondo al notebook `02_raw_clean`.\n","- **Valori mancanti:** la copertura dei dati nella serie storica √® completa per le variabili principali (RD%, tonnellate totali, pro capite). I **124 comuni con dati mancanti** nel dataset delta sono esclusi dalla classificazione per quadrante.\n","\n","---\n","\n","## Output Prodotti\n","\n","| File | Descrizione |\n","|------|-------------|\n","| `serie_comuni_rd_ru_2019_2023.parquet` | Dataset long (comune √ó anno), serie storica completa |\n","| `serie_comuni_rd_ru_2019_2023.csv` | Stessa serie in formato CSV per Power BI |\n","| `mart_comuni_delta_2020_2023.parquet` | Dataset wide con delta e classificazione per comune |\n","| `mart_comuni_delta_2020_2023.csv` | Stessa classificazione in formato CSV per Power BI |\n","\n","---\n","\n","## Lettura dei risultati\n","\n","Circa **1 comune su 3** aumenta la raccolta differenziata ma produce pi√π rifiuti complessivi.  \n","I comuni realmente virtuosi, che differenziano di pi√π e riducono anche i rifiuti pro capite, sono il **24,6%** del totale.\n","\n","Il dato suggerisce che politiche basate esclusivamente sull'aumento della raccolta differenziata non incidono necessariamente sulla quantit√† di rifiuti prodotti: **prevenzione e riduzione dei consumi** restano centrali. La raccolta differenziata √® uno strumento necessario, ma non risolutivo.\n"]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.14.2"}},"nbformat":4,"nbformat_minor":5}